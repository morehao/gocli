[English](./README.md) | [ç®€ä½“ä¸­æ–‡](./README_cn.md)


# gocli ä»‹ç»
`gocli` æ˜¯ä¸€ä¸ªä½¿ç”¨ Go è¯­è¨€å¼€å‘çš„å‘½ä»¤è¡Œå·¥å…·é›†åˆï¼Œæ—¨åœ¨æå‡å¼€å‘æ•ˆç‡ï¼Œç›®å‰åŒ…å«**ä»£ç ç”Ÿæˆ**å’Œ**å¿«é€Ÿæ–°å»ºé¡¹ç›®**åŠŸèƒ½ã€‚

# å¿«é€Ÿå¼€å§‹

## å®‰è£…

```bash
go install github.com/morehao/gocli@latest
```

## generate

`generate`æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ä»£ç ç”Ÿæˆå·¥å…·ï¼ŒåŸºäºæ¨¡æ¿æ–‡ä»¶å’Œæ•°æ®åº“ç»“æ„å¿«é€Ÿç”Ÿæˆä»£ç ã€‚é¡¹ç›®ç»“æ„å’Œé£æ ¼å‚ç…§[go-gin-web](https://github.com/morehao/go-gin-web)ã€‚

### åŠŸèƒ½ç‰¹æ€§

* ğŸš€ **å¿«é€Ÿå¼€å‘**ï¼šåŸºäº MySQL è¡¨ç»“æ„å¿«é€Ÿç”Ÿæˆå®Œæ•´çš„ CRUD æ¨¡å—
* ğŸ“¦ **å¤šå±‚ä»£ç ç”Ÿæˆ**ï¼šæ”¯æŒ modelã€daoã€serviceã€controllerã€dtoã€router ç­‰å¤šå±‚ä»£ç 
* ğŸ¯ **ä¸‰ç§ç”Ÿæˆæ¨¡å¼**ï¼šmoduleï¼ˆå®Œæ•´æ¨¡å—ï¼‰ã€modelï¼ˆä»…æ•°æ®å±‚ï¼‰ã€apiï¼ˆå•ä¸ªæ¥å£ï¼‰
* ğŸ”§ **é«˜åº¦å¯å®šåˆ¶**ï¼šå¯é…ç½®å±‚çº§åç§°ã€çˆ¶çº§ç›®å½•ã€æ–‡ä»¶åå‰ç¼€
* âœ¨ **è‡ªåŠ¨æ ¼å¼åŒ–**ï¼šç”Ÿæˆçš„ä»£ç è‡ªåŠ¨ä½¿ç”¨ `gofmt` æ ¼å¼åŒ–
* ğŸ“– **æ•°æ®åº“é©±åŠ¨**ï¼šè¯»å– MySQL è¡¨ç»“æ„ç”Ÿæˆå‡†ç¡®çš„æ¨¡å‹å®šä¹‰

### ç”Ÿæˆæ¨¡å¼

#### 1. **module** - å®Œæ•´æ¨¡å—ç”Ÿæˆ

ç”ŸæˆåŒ…å«æ‰€æœ‰å±‚çº§çš„å®Œæ•´ CRUD æ¨¡å—ï¼š
- **model**ï¼šæ•°æ®åº“æ¨¡å‹
- **dao**ï¼šæ•°æ®è®¿é—®å¯¹è±¡
- **object**ï¼šä¸šåŠ¡å¯¹è±¡
- **controller**ï¼šHTTP è¯·æ±‚å¤„ç†å™¨
- **service**ï¼šä¸šåŠ¡é€»è¾‘å±‚
- **dto**ï¼šè¯·æ±‚/å“åº”å¯¹è±¡
- **router**ï¼šè·¯ç”±æ³¨å†Œ
- **code**ï¼šé”™è¯¯ç å®šä¹‰

**ä½¿ç”¨åœºæ™¯**ï¼šä»é›¶å¼€å§‹åˆ›å»ºæ–°åŠŸèƒ½æ¨¡å—

```bash
gocli generate -m module -a demoapp
```

#### 2. **model** - æ•°æ®å±‚ç”Ÿæˆ

ä»…ç”Ÿæˆæ•°æ®å±‚ä»£ç ï¼š
- **model**ï¼šå¸¦ GORM æ ‡ç­¾çš„æ•°æ®åº“æ¨¡å‹
- **dao**ï¼šæ•°æ®è®¿é—®æ–¹æ³•
- **object**ï¼šç”¨äºæ•°æ®è½¬æ¢çš„ä¸šåŠ¡å¯¹è±¡

**ä½¿ç”¨åœºæ™¯**ï¼šåªéœ€æ·»åŠ æ•°æ®åº“è¡¨ï¼Œæ— éœ€å®Œæ•´ CRUD æ“ä½œ

```bash
gocli generate -m model -a demoapp
```

#### 3. **api** - å•ä¸ªæ¥å£ç”Ÿæˆ

ä¸ºç°æœ‰æ¨¡å—æ·»åŠ æ–°çš„ API æ¥å£ï¼š
- **controller**ï¼šæ–°çš„æ§åˆ¶å™¨æ–¹æ³•
- **service**ï¼šæ–°çš„æœåŠ¡æ–¹æ³•
- **dto**ï¼šè¯·æ±‚/å“åº”ç»“æ„ä½“
- **router**ï¼šè·¯ç”±æ³¨å†Œ

**ä½¿ç”¨åœºæ™¯**ï¼šä¸ºå·²æœ‰åŠŸèƒ½æ·»åŠ æ–°çš„æ¥å£

```bash
gocli generate -m api -a demoapp
```

### å‘½ä»¤æ‰§è¡Œå‰æ

1. **åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ**ï¼šéœ€åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼ˆä¾‹å¦‚ `go-gin-web` ç›®å½•ï¼‰
2. **æŒ‡å®šåº”ç”¨åç§°**ï¼šé€šè¿‡ `--app` å‚æ•°æŒ‡å®šè¦ç”Ÿæˆä»£ç çš„åº”ç”¨åç§°ï¼ˆå¦‚ `demoapp`ï¼‰
3. **é…ç½®æ–‡ä»¶å¿…éœ€**ï¼šç¡®ä¿ `apps/{appName}/config/code_gen.yaml` æ–‡ä»¶å­˜åœ¨

ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š
```yaml
mysql_dsn: root:123456@tcp(127.0.0.1:3306)/demo?charset=utf8mb4&parseTime=True&loc=Local
#layer_parent_dir_map:
#  model: model
#  dao: dao
#layer_name_map:
#  model: mysqlmodel
#  dao: mysqldao
#layer_prefix_map:
#  service: srv
module:
  package_name: user
  description: ç”¨æˆ·ç™»å½•è®°å½•
  table_name: user_login_log
model:
  package_name: user
  description: ç”¨æˆ·
  table_name: user
api:
  package_name: user
  target_filename: user_login_log.go
  function_name: Delete
  http_method: POST
  description: åˆ é™¤ç™»å½•è®°å½•
  api_doc_tag: ç”¨æˆ·ç™»å½•è®°å½•
```
### é…ç½®è¯´æ˜

#### å…¨å±€é…ç½®

| é…ç½®é¡¹ | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ˜¯å¦å¿…å¡« |
| ----- | ---- | ------ | ------- |
| `mysql_dsn` | MySQL æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸² | `root:123456@tcp(127.0.0.1:3306)/demo?charset=utf8mb4&parseTime=True&loc=Local` | âœ… å¿…å¡« |
| `layer_parent_dir_map` | å„å±‚ä»£ç çš„çˆ¶ç›®å½•æ˜ å°„ | `model: model`<br>`controller: internal` | âŒ å¯é€‰ |
| `layer_name_map` | è‡ªå®šä¹‰å±‚çº§ç›®å½•åç§° | `model: mysqlmodel`<br>`dao: mysqldao` | âŒ å¯é€‰ |
| `layer_prefix_map` | å„å±‚æ–‡ä»¶åå‰ç¼€ | `service: svc`<br>`controller: ctr` | âŒ å¯é€‰ |

**è‡ªå®šä¹‰é…ç½®ç¤ºä¾‹ï¼š**
```yaml
# è‡ªå®šä¹‰å±‚çº§çˆ¶ç›®å½•
layer_parent_dir_map:
  controller: internal
  service: internal
  dto: internal

# è‡ªå®šä¹‰å±‚çº§åç§°
layer_name_map:
  model: mysqlmodel
  dao: mysqldao

# è‡ªå®šä¹‰æ–‡ä»¶åå‰ç¼€
layer_prefix_map:
  service: svc
  controller: ctr
```

#### æ¨¡å—é…ç½®ï¼ˆç”¨äº `module` æ¨¡å¼ï¼‰

| é…ç½®é¡¹ | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ˜¯å¦å¿…å¡« |
| ----- | ---- | ------ | ------- |
| `package_name` | æ¨¡å—åŒ…å | `user` | âœ… å¿…å¡« |
| `description` | æ¨¡å—æè¿°ï¼ˆç”¨äºæ³¨é‡Šï¼‰ | `ç”¨æˆ·ç™»å½•è®°å½•` | âœ… å¿…å¡« |
| `table_name` | MySQL è¡¨å | `user_login_log` | âœ… å¿…å¡« |

#### æ¨¡å‹é…ç½®ï¼ˆç”¨äº `model` æ¨¡å¼ï¼‰

| é…ç½®é¡¹ | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ˜¯å¦å¿…å¡« |
| ----- | ---- | ------ | ------- |
| `package_name` | æ¨¡å‹åŒ…å | `user` | âœ… å¿…å¡« |
| `description` | æ¨¡å‹æè¿° | `ç”¨æˆ·` | âœ… å¿…å¡« |
| `table_name` | MySQL è¡¨å | `user` | âœ… å¿…å¡« |

#### API é…ç½®ï¼ˆç”¨äº `api` æ¨¡å¼ï¼‰

| é…ç½®é¡¹ | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ˜¯å¦å¿…å¡« |
| ----- | ---- | ------ | ------- |
| `package_name` | API åŒ…å | `user` | âœ… å¿…å¡« |
| `target_filename` | ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å | `user_login_log.go` | âœ… å¿…å¡« |
| `function_name` | å‡½æ•°/æ–¹æ³•å | `Delete` | âœ… å¿…å¡« |
| `http_method` | HTTP è¯·æ±‚æ–¹æ³• | `POST`ã€`GET`ã€`PUT`ã€`DELETE` | âœ… å¿…å¡« |
| `description` | API æè¿° | `åˆ é™¤ç™»å½•è®°å½•` | âœ… å¿…å¡« |
| `api_doc_tag` | Swagger/API æ–‡æ¡£æ ‡ç­¾ | `ç”¨æˆ·ç™»å½•è®°å½•` | âœ… å¿…å¡« |

### å‘½ä»¤ä½¿ç”¨è¯´æ˜

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆå¦‚ go-gin-webï¼‰ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤

# ç”Ÿæˆå®Œæ•´æ¨¡å—ï¼ˆmodel + dao + service + controller + dto + router + codeï¼‰
gocli generate -m module -a demoapp

# ä»…ç”Ÿæˆæ•°æ®å±‚ï¼ˆmodel + dao + objectï¼‰
gocli generate -m model -a demoapp

# ç”Ÿæˆå•ä¸ª API æ¥å£ï¼ˆcontroller + service + dto + routerï¼‰
gocli generate -m api -a demoapp
```

**å‚æ•°è¯´æ˜ï¼š**
- `-m, --mode`ï¼šç”Ÿæˆæ¨¡å¼ - `module`ã€`model` æˆ– `api`ï¼ˆå¿…å¡«ï¼‰
- `-a, --app`ï¼šåº”ç”¨åç§°ï¼Œä¾‹å¦‚ï¼š`demoapp`ï¼ˆå¿…å¡«ï¼‰

**ä½¿ç”¨æŠ€å·§ï¼š**
- ğŸ’¡ ä»é›¶å¼€å§‹æ–°åŠŸèƒ½æ—¶ä½¿ç”¨ `module` æ¨¡å¼
- ğŸ’¡ åªéœ€æ•°æ®åº“æ¨¡å‹æ—¶ä½¿ç”¨ `model` æ¨¡å¼
- ğŸ’¡ ä¸ºç°æœ‰æ¨¡å—æ·»åŠ æ–°æ¥å£æ—¶ä½¿ç”¨ `api` æ¨¡å¼
- ğŸ’¡ æŸ¥çœ‹ [go-gin-web](https://github.com/morehao/go-gin-web) é¡¹ç›®çš„ `Makefile` äº†è§£å®é™…ä½¿ç”¨ç¤ºä¾‹

### ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„

å½“ä½ æ‰§è¡Œ `gocli generate -m module -a demoapp` æ—¶ï¼Œå·¥å…·ä¼šç”Ÿæˆï¼š

```
apps/demoapp/
â”œâ”€â”€ model/              # æ•°æ®åº“æ¨¡å‹
â”‚   â””â”€â”€ user.go
â”œâ”€â”€ dao/                # æ•°æ®è®¿é—®å±‚
â”‚   â””â”€â”€ daouser/
â”‚       â””â”€â”€ user.go
â”œâ”€â”€ object/             # ä¸šåŠ¡å¯¹è±¡
â”‚   â””â”€â”€ objuser/
â”‚       â””â”€â”€ user.go
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ controller/     # HTTP å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ ctruser/
â”‚   â”‚       â””â”€â”€ user.go
â”‚   â”œâ”€â”€ service/        # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â””â”€â”€ svcuser/
â”‚   â”‚       â””â”€â”€ user.go
â”‚   â””â”€â”€ dto/            # è¯·æ±‚/å“åº” DTO
â”‚       â””â”€â”€ dtouser/
â”‚           â”œâ”€â”€ request.go
â”‚           â””â”€â”€ response.go
â””â”€â”€ router/             # è·¯ç”±æ³¨å†Œ
    â””â”€â”€ user.go

pkg/code/               # å…±äº«é”™è¯¯ç 
â””â”€â”€ user.go
```

## cutter
`cutter`æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºå¿«é€ŸåŸºäºç°æœ‰ Go é¡¹ç›®åˆ›å»ºæ–°çš„ Go é¡¹ç›®ï¼Œæˆ–åœ¨åŒä¸€é¡¹ç›®å†…å…‹éš†åº”ç”¨ã€‚

### åŠŸèƒ½ç‰¹æ€§

#### 1. å…‹éš†æ•´ä¸ªé¡¹ç›®

- åœ¨ç°æœ‰é¡¹ç›®æ ¹è·¯å¾„ä¸‹æ‰§è¡Œå‘½ä»¤å¯åˆ›å»ºæ–°çš„Goé¡¹ç›®
- åˆ›å»ºæ–°é¡¹ç›®æ—¶åŸºäº.gitignoreæ–‡ä»¶è¿‡æ»¤åˆ›å»ºçš„æ–‡ä»¶
- è‡ªåŠ¨æ›¿æ¢ import è·¯å¾„
- è‡ªåŠ¨æ›´æ–° go.mod æ–‡ä»¶ä¸­çš„æ¨¡å—åç§°
- è‡ªåŠ¨åˆ é™¤ .git ç›®å½•

> âš ï¸ æ³¨æ„ï¼šä¸€å®šè¦åœ¨æ¨¡æ¿é¡¹ç›®çš„æ ¹è·¯å¾„ä¸‹æ‰§è¡Œå‘½ä»¤

#### 2. å…‹éš†é¡¹ç›®å†…çš„åº”ç”¨ï¼ˆæ–°åŠŸèƒ½ï¼ï¼‰

- åœ¨åŒä¸€é¡¹ç›®å†…å°†ç°æœ‰åº”ç”¨å…‹éš†åˆ°æ–°åº”ç”¨
- å¿…é¡»åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤
- è‡ªåŠ¨æ›¿æ¢åŒ…åå’Œ import è·¯å¾„
- æ›¿æ¢é…ç½®æ–‡ä»¶ï¼ˆ`.yaml`ã€`.yml`ï¼‰ä¸­çš„åº”ç”¨åç§°
- éµå¾ª `.gitignore` è§„åˆ™

### å‘½ä»¤ä½¿ç”¨è¯´æ˜

#### å…‹éš†æ•´ä¸ªé¡¹ç›®

```shell
cd /appTemplatePath
gocli cutter -d /yourAppPath
```

**å‚æ•°è¯´æ˜ï¼š**
- `-d, --destination`ï¼šæ–°é¡¹ç›®çš„ç›®æ ‡è·¯å¾„ï¼Œä¾‹å¦‚ï¼š`/user/myApp`ã€‚æ­¤å‚æ•°ä¸ºå¿…å¡«é¡¹ã€‚

#### å…‹éš†é¡¹ç›®å†…çš„åº”ç”¨

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼ˆä¾‹å¦‚ go-gin-webï¼‰
cd /path/to/go-gin-web

# å°† demoapp å…‹éš†åˆ° newapp
gocli cutter app -n newapp

# æˆ–æŒ‡å®šæºåº”ç”¨
gocli cutter app -s demoapp -n myapp
```

**å‚æ•°è¯´æ˜ï¼š**
- `-s, --source`ï¼šè¦å…‹éš†çš„æºåº”ç”¨åç§°ï¼ˆé»˜è®¤å€¼ï¼š`demoapp`ï¼‰
- `-n, --name`ï¼šæ–°åº”ç”¨åç§°ï¼ˆå¿…å¡«ï¼‰

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
# å°† apps/demoapp å…‹éš†åˆ° apps/userapp
gocli cutter app -n userapp

# å°† apps/demoapp å…‹éš†åˆ° apps/adminapp
gocli cutter app -s demoapp -n adminapp
```

æ­¤å‘½ä»¤ä¼šè‡ªåŠ¨å®Œæˆï¼š
1. å¤åˆ¶æ•´ä¸ªåº”ç”¨ç›®å½•ç»“æ„
2. æ›¿æ¢æ‰€æœ‰ import è·¯å¾„ï¼š`module/apps/demoapp/...` â†’ `module/apps/newapp/...`
3. æ›¿æ¢é…ç½®æ–‡ä»¶ä¸­çš„åº”ç”¨åç§°
4. ä¿æŒ Go ä»£ç çš„æ­£ç¡®æ ¼å¼


